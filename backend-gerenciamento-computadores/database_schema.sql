-- Script SQL para criação do banco de dados de gerenciamento de computadores
-- ATUALIZADO com base no CSV fornecido.

-- Apaga as tabelas existentes para uma recriação limpa
DROP TABLE IF EXISTS layout CASCADE;
DROP TABLE IF EXISTS patrimonio CASCADE;
DROP TABLE IF EXISTS gerencia CASCADE;
DROP TABLE IF EXISTS modelo_computador CASCADE;
DROP TABLE IF EXISTS baixa_patrimonial CASCADE;
DROP TABLE IF EXISTS users CASCADE;

-- Criação da tabela Modelo do Computador
CREATE TABLE modelo_computador (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    processador VARCHAR(255) NOT NULL,
    quantidade_ram VARCHAR(255) NOT NULL,
    tipo_ram VARCHAR(255) NOT NULL,
    sistema_operacional VARCHAR(255) NOT NULL,
    ssd BOOLEAN NOT NULL
);

-- Criação da tabela Gerência
CREATE TABLE gerencia (
    id SERIAL PRIMARY KEY,
    nome TEXT NOT NULL UNIQUE
);

-- Criação da tabela Patrimônio
CREATE TABLE patrimonio (
    id SERIAL PRIMARY KEY,
    patrimonio TEXT NOT NULL UNIQUE,
    nome_servidor_responsavel TEXT NOT NULL,
    modelo_id INTEGER NOT NULL,
    gerencia_id INTEGER NOT NULL,
    observacao VARCHAR(255),
    FOREIGN KEY (modelo_id) REFERENCES modelo_computador(id),
    FOREIGN KEY (gerencia_id) REFERENCES gerencia(id)
);

-- Criação da tabela Layout (estrutura mantida, sem dados)
CREATE TABLE layout (
    id SERIAL PRIMARY KEY,
    gerencia_id INTEGER NOT NULL UNIQUE,
    layout_data TEXT NOT NULL,
    is_diagram BOOLEAN DEFAULT FALSE,
    grid_cols INTEGER DEFAULT 4,
    grid_rows INTEGER DEFAULT 4,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (gerencia_id) REFERENCES gerencia(id) ON DELETE CASCADE
);

-- Criação da tabela Baixa Patrimonial
CREATE TABLE baixa_patrimonial (
    id SERIAL PRIMARY KEY,
    patrimonio TEXT NOT NULL UNIQUE,
    nome_servidor_responsavel TEXT NOT NULL,
    modelo_id INTEGER NOT NULL,
    gerencia_id INTEGER NOT NULL, -- Pode ser NULL após baixa
    data_baixa TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    motivo_baixa TEXT,
    FOREIGN KEY (modelo_id) REFERENCES modelo_computador(id),
    FOREIGN KEY (gerencia_id) REFERENCES gerencia(id)
);

-- Criação da tabela Users
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(80) UNIQUE NOT NULL,
    password_hash VARCHAR(128) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    active BOOLEAN DEFAULT TRUE
);

-- Inserção dos dados na tabela modelo_computador (extraídos do CSV)
INSERT INTO modelo_computador (id, nome, processador, quantidade_ram, tipo_ram, sistema_operacional, ssd) VALUES
(1, 'Arquimedes H110', 'Intel Core i3 7100', '4GB', 'DDR4', 'Windows 10', FALSE),
(2, 'Positivo Antigo', 'Intel Core i3 4100', '4GB', 'DDR3', 'Windows 8', FALSE),
(3, 'Daten', 'Intel Core i3 4100', '4GB', 'DDR3', 'Windows 8', FALSE),
(4, 'Positivo Master D6200', 'Intel Core i3 8100', '16GB', 'DDR4', 'Windows 11', TRUE),
(5, 'Lenovo M75s', 'AMD Ryzen 5 PRO 5650G', '16GB', 'DDR4', 'Windows 11', TRUE);

-- Inserção dos dados na tabela gerencia (extraídos do CSV e ordenados)
INSERT INTO gerencia (id, nome) VALUES
(1, '2o Andar'),
(2, 'Assejur SMADH'),
(3, 'Assejur SMSA'),
(4, 'DIAJ - DIRETORIA E PROTOCOLO'),
(5, 'DIAJ - RECEPÇÃO'),
(6, 'DIAJ - RPV'),
(7, 'DIAJ - SETOR VAZIO'),
(8, 'DIAJ - SUPORTE E DISTRIBUIÇÃO'),
(9, 'DICP'),
(10, 'DPGF'),
(11, 'DTAT'),
(12, 'GEPESS'),
(13, 'GEPESS DIRETORIA'),
(14, 'RECEPÇÃO GABINETE'),
(15, 'SALA 01'),
(16, 'SALA 02 - DIRETORIA SUGEJUD'),
(17, 'SALA 03'),
(18, 'SALA 04'),
(19, 'SALA 05'),
(20, 'SALA 06'),
(21, 'SALA 07'),
(22, 'SALA 08'),
(23, 'SALA 09'),
(24, 'SALA 10'),
(25, 'SALA 11'),
(26, 'SALA 12'),
(27, 'SALA 13'),
(28, 'SALA CHEFE GABINETE'),
(29, 'SALA DE REUNIÃO'),
(30, 'SALA DO PROCURADOR GERAL'),
(31, 'SALA SUBPROCURADORIA GERAL'),
(32, 'Almoxarifado');

-- Inserção dos dados na tabela patrimonio (com base no CSV)
-- A correspondência de modelo_id e gerencia_id foi feita com base nos inserts acima.
INSERT INTO patrimonio (id, patrimonio, nome_servidor_responsavel, modelo_id, gerencia_id) VALUES
(1, '991011057400', 'Cristine Rattes', 1, 1),
(2, '991011054700', 'Estação', 1, 2),
(3, '991009495900', 'Estação', 2, 2),
(4, '991009740100', 'Estação', 3, 2),
(5, '991011059200', 'Valeria', 1, 2),
(6, '991011058400', 'Estação', 1, 3),
(7, '991011851300', 'Barbara Magalhaes', 4, 4),
(8, '991012075800', 'Karina Gomes', 4, 4),
(9, '991011052700', 'Estação', 1, 4),
(10, '991009491700', 'Vazio', 2, 4),
(11, '991012075600', 'Kaua', 4, 4),
(12, '991011057100', 'Estação', 1, 4),
(13, '991012075900', 'Digitalizacao', 4, 4),
(14, '991011851800', 'Digitalizacao', 4, 4),
(15, '991009743000', 'Mauricio', 3, 5),
(16, '991011052100', 'Estação', 1, 6),
(17, '991011055700', 'Marlene', 1, 6),
(18, '991013456900', 'Cristina', 4, 6),
(19, '991011061500', 'Josina', 1, 6),
(20, '991009741800', 'Luanda', 3, 6),
(21, '991011053100', 'Estação', 1, 6),
(22, '991011851500', 'Karla Patricia', 4, 6),
(23, '991011853400', 'Elaine Mendes', 4, 6),
(24, '991011059500', 'Talita', 1, 6),
(25, '991011054600', 'Luciana', 1, 6),
(26, '991011060800', 'Flaviana', 1, 6),
(27, '991011053600', 'Cleidiane', 1, 6),
(28, '991009495600', 'Mariana de Aguiar', 2, 6),
(29, '991009741300', 'Andreia', 3, 6),
(30, '991009739300', 'Carlos', 3, 6),
(31, '991009491800', 'Helio', 2, 6),
(32, '991009492600', 'Vazio', 2, 7),
(33, '991000568700', 'Digitalizacao', 3, 7),
(34, '991009741100', 'Vazio', 3, 7),
(35, '991011052800', 'Estação', 1, 7),
(36, '991011061700', 'Luciana Melo/Marcia', 1, 7),
(37, '991011851700', 'Marta Elena', 4, 7),
(38, '991011055100', 'Estação', 1, 7),
(39, '991011852600', 'Ao Lado da Karine', 4, 8),
(40, '991011850200', 'Vazio', 4, 8),
(41, '991011052200', 'Estação', 1, 8),
(42, '991011054500', 'Adelson', 1, 8),
(43, '991011851900', 'Maria Isabel', 4, 8),
(44, '991013456800', 'Karine Lanza', 4, 8),
(45, '991013457000', 'Gislaine', 4, 8),
(46, '991011053700', 'Adriano', 1, 8),
(47, '991012076200', 'Ana Laura', 4, 8),
(48, '991011055500', 'Alessandra', 1, 8),
(49, '991011918800', 'Gracielle', 4, 8),
(50, '991013457100', 'Ernesto', 4, 8),
(51, '991011060400', 'Tatiana', 1, 8),
(52, '991011056200', 'Cristiane Lima', 1, 8),
(53, '991011918900', 'Raquel', 4, 8),
(54, '991011852700', 'Ricardo Carvalho', 4, 8),
(55, '991011853700', 'Luciana Pessoa', 4, 8),
(56, '991012076100', 'Elane', 4, 8),
(57, '991012076600', 'Maria Lopes', 4, 8),
(58, '991011052500', 'Estação', 1, 8),
(59, '991012076700', 'Carolina Francisco', 4, 8),
(60, '991011853600', 'Ronaldo', 4, 8),
(61, '991011060900', 'Paula', 1, 8),
(62, '991012076800', 'Cristine Rattes', 4, 8),
(63, '991011055600', 'Joyce', 1, 8),
(64, '991011852100', 'Bruno Lage', 4, 8),
(65, '991009492800', 'Vazio', 2, 8),
(66, '991009740600', 'Mariza', 3, 8),
(67, '991009493400', 'Luiz', 2, 8),
(68, '991011850500', 'Kenia Aparecida', 4, 9),
(69, '991012074800', 'Josue Denio', 4, 9),
(70, '991013456700', 'Rosemaire Ferreira', 4, 9),
(71, '991011850300', 'Marta Paulino', 4, 9),
(72, '991011850400', 'Ana Claudia Praxedes', 4, 9),
(73, '991011059000', 'Estação', 1, 9),
(74, '991011054000', 'Irade', 1, 9),
(75, '991011054200', 'Estação', 1, 9),
(76, '991011055800', 'Maria Aparecida dos Santos', 1, 9),
(77, '991012075000', 'Edmar', 4, 9),
(78, '991011060100', 'Ana Carolina Pousa', 1, 9),
(79, '991011060000', 'Gabriela Evangelista', 1, 9),
(80, '991011058900', 'Adriana Miranda', 1, 9),
(81, '991011060200', 'Estação', 1, 9),
(82, '991012075500', 'Vitória Dias', 4, 9),
(83, '991011053300', 'Vitoria Dias', 1, 9),
(84, '991011053800', 'Denise Maria', 1, 9),
(85, '991011060500', 'Widler', 1, 9),
(86, '991011852200', 'Jose Affonso', 4, 9),
(87, '991012074700', 'Irade', 4, 9),
(88, '991012074900', 'Michelle Cristiane', 4, 9),
(89, '991011054300', 'Kenia Aparecida', 1, 9),
(90, '991009742800', 'Estagiaria', 3, 9),
(91, '991009494800', 'Cristina Maria', 2, 9),
(92, '991011852400', 'Margareth Gomes', 4, 9),
(93, '991000569000', 'Estação Remota', 3, 10),
(94, '991011061000', 'Estação', 1, 10),
(95, '991009739500', 'Tulio', 3, 10),
(96, '991011850600', 'Dircy', 4, 10),
(97, '991012075300', 'Simone', 4, 10),
(98, '991012075400', 'Laura', 4, 10),
(99, '991011853100', 'Ana Cristina', 4, 10),
(100, '991011850700', 'Fernanda Machado', 4, 10),
(101, '991011853200', 'Fernanda', 4, 10),
(102, '991012075200', 'Silvia', 4, 10),
(103, '991012075700', 'Washington', 4, 10),
(104, '991012075100', 'Rodrigo', 4, 10),
(105, '991011851000', 'Isabel', 4, 10),
(106, '991011052900', 'Helio', 1, 10),
(107, '991011850800', 'Claudia', 4, 10),
(108, '991011053200', 'Antonio', 1, 10),
(109, '991011851100', 'Ricardo', 4, 10),
(110, '991011058100', 'Vazio', 1, 10),
(111, '991015100900', 'Rafael Assumpção', 5, 11),
(112, '991017070300', 'Marco Ribeiro', 5, 11),
(113, '991017081600', 'Danilo Rodrigues', 5, 11),
(114, '991017077900', 'Isaac Martins', 5, 11),
(115, '991015103000', 'Danilo Lima', 5, 11),
(116, '991017077800', 'Francisco Meirelles', 5, 11),
(117, '991011851200', 'Cristhian', 4, 11),
(118, '991011058000', 'Servidor RENAVAN', 1, 11),
(119, '991009494700', 'Vazio', 2, 11),
(120, '991009490600', 'Vazio', 2, 11),
(121, '991009493300', 'Vazio', 2, 11),
(122, '991009493100', 'Vazio', 2, 11),
(123, '991009494500', 'Vazio', 2, 11),
(124, '991009492900', 'Vazio', 2, 11),
(125, '991009496100', 'Vazio', 2, 11),
(126, '991011852900', 'Raphael Bessa', 4, 13),
(127, '991011057700', 'Estação', 1, 13),
(128, '991011853800', 'Duda', 4, 12),
(129, '991012076000', 'Chamado/Valeria', 4, 12),
(130, '991011850100', 'Thiago', 4, 12),
(131, '991011853000', 'Angela', 4, 12),
(132, '991011851600', 'Luiza', 4, 12),
(133, '991011059400', 'Estação', 1, 14),
(134, '991011852000', 'Aparecida Tavares', 4, 14),
(135, '991011056900', 'Marina França', 1, 15),
(136, '991009741700', 'Primeira estação', 3, 15),
(137, '991000568800', 'Terceira estação', 3, 15),
(138, '991011852500', 'Luciana Camargo/VInicius Magalhaes', 4, 15),
(139, '991011852300', 'Vinicius Nascimento/Guilherme', 4, 24),
(140, '991011061400', 'Leandro Penido', 1, 24),
(141, '991011057200', 'Carlos Ruas', 1, 24),
(142, '991009757100', 'Quarta estação', 3, 24),
(143, '991011060300', 'Maria Jocélia', 1, 25),
(144, '991011059900', 'Romero', 1, 25),
(145, '991011059800', 'Anna Júlia', 1, 25),
(146, '991011054900', 'Walter Santos', 1, 25),
(147, '991009741900', 'Primeira estação', 3, 26),
(148, '991011061300', 'Victor Teixeira', 1, 26),
(149, '991011060600', 'Yves', 1, 26),
(150, '991011919000', 'Luiz Felipe', 4, 26),
(151, '991011058500', 'Marina Ferreira', 1, 27),
(152, '991011056300', 'Marina Saad', 1, 27),
(153, '991011060700', 'Daniela Carla', 1, 27),
(154, '991012076500', 'Ingrid/Ana Magnabosco', 4, 16),
(155, '991011056700', 'Matheus Canazart', 1, 16),
(156, '991011061800', 'Estação', 1, 16),
(157, '991011057500', 'Estação', 1, 16),
(158, '991011057900', 'Claudia Cristina', 1, 17),
(159, '991011057000', 'Lucienne Pitchon', 1, 17),
(160, '991011058200', 'Junia Franco', 1, 17),
(161, '991011852800', 'Alexandre Augusto', 4, 17),
(162, '991011918700', 'James Henrique', 4, 18),
(163, '991011058600', 'Eduardo Vilela', 1, 18),
(164, '991011057800', 'Cristiano Reis', 1, 18),
(165, '991011052300', 'Paulo Grahal', 1, 18),
(166, '991011059300', 'Marcelo Veiga', 1, 19),
(167, '991012076400', 'Bruno Pereira', 4, 19),
(168, '991012076300', 'Rodrigo Rabelo', 4, 19),
(169, '991012076900', 'Ricardo Perez', 4, 19),
(170, '991011058700', 'Rafael Dutra', 1, 20),
(171, '991011056400', 'Ana Cláudia', 1, 20),
(172, '991011057600', 'Vitória Jacob', 1, 20),
(173, '991011057300', 'Heloísa Carvalho', 1, 20),
(174, '991011053500', 'Estação', 1, 21),
(175, '991011053400', 'Fernando Magalhães', 1, 21),
(176, '991011053000', 'Camila Pyramo', 1, 21),
(177, '991011056800', 'Fernando Couto', 1, 21),
(178, '991011059700', 'Delze Laureano', 1, 22),
(179, '991011058300', 'Luiz Fernando', 1, 22),
(180, '991009740500', 'Terceira estação', 3, 22),
(181, '991011851400', 'Pedro Victor/Rusvel Beltrame', 4, 22),
(182, '991011052400', 'Jéssica Zanco', 1, 23),
(183, '991011062000', 'Renata Sena', 1, 23),
(184, '991011056100', 'Júlio Cesar', 1, 23),
(185, '991011054100', 'Hercilia Procopio', 1, 23),
(186, '991011850900', 'Felipe', 4, 28),
(187, '991009494100', 'Reunião', 2, 29),
(188, '991011853500', 'Hercules Guerra', 4, 30),
(189, '991011853300', 'Izabela Boaventura', 4, 31),
(190, '991011055900', 'Estação', 1, 31),
(191, '991009493900', 'Vazio', 2, 32),
(192, '991011059100', 'Vazio', 1, 32),
(193, '991011061900', 'Vazio', 1, 32),
(194, '991009742000', 'Vazio', 3, 32),
(195, '991009741200', 'Vazio', 3, 32),
(196, '991011056600', 'Vazio', 1, 32),
(197, '991011056000', 'Vazio', 1, 32),
(198, '991011058800', 'Vazio', 1, 32),
(199, '991009494400', 'Vazio', 2, 32),
(200, '991009740000', 'Vazio', 3, 32),
(201, '991009743600', 'Vazio', 3, 32),
(202, '991009758300', 'Vazio', 3, 32),
(203, '991009491600', 'Vazio', 2, 32),
(204, '991009492400', 'Vazio', 2, 32);

-- Corrigir sequences após inserção de dados com IDs específicos
SELECT setval('patrimonio_id_seq', (SELECT MAX(id) FROM patrimonio));
SELECT setval('modelo_computador_id_seq', (SELECT MAX(id) FROM modelo_computador));
SELECT setval('gerencia_id_seq', (SELECT MAX(id) FROM gerencia));
SELECT setval('baixa_patrimonial_id_seq', (SELECT MAX(id) FROM baixa_patrimonial));
SELECT setval('layout_id_seq', (SELECT MAX(id) FROM layout));
SELECT setval('users_id_seq', (SELECT MAX(id) FROM users));

-- Fim do script